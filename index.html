<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omate角色卡管理器</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 所有样式保持不变 */
        /* 为了节省空间，这里省略了完整的CSS样式 */
        /* 请使用之前提供的完整样式 */
    </style>
</head>
<body>
    <!-- HTML结构保持不变 -->
    <!-- 请使用之前提供的完整HTML结构 -->

    <script>
        // 状态管理
        const state = {
            currentTheme: localStorage.getItem('theme') || 'light',
            cards: [],
            currentCard: null,
            blurStrength: localStorage.getItem('blur') || 12,
            animationSpeed: localStorage.getItem('animationSpeed') || 4,
            opacityValue: localStorage.getItem('opacity') || 70,
            githubToken: localStorage.getItem('githubToken') || '',
            repoName: localStorage.getItem('repoName') || '',
            branchName: localStorage.getItem('branchName') || 'main',
            cardImage: null,
            coverImage: null,
            cardsLoaded: false,
            currentPath: '/',
            selectedFile: null
        };

        // DOM元素引用
        const elements = {
            githubBrowser: document.getElementById('githubBrowser'),
            mainApp: document.getElementById('mainApp'),
            repoPath: document.getElementById('repoPath'),
            currentPath: document.getElementById('currentPath'),
            fileBrowser: document.getElementById('fileBrowser'),
            openFileBtn: document.getElementById('openFileBtn'),
            browserThemeToggle: document.getElementById('browserThemeToggle'),
            browserSettingsBtn: document.getElementById('browserSettingsBtn'),
            themeToggle: document.getElementById('themeToggle'),
            settingsBtn: document.getElementById('settingsBtn'),
            closeSettings: document.getElementById('closeSettings'),
            settingsPanel: document.getElementById('settingsPanel'),
            githubBtn: document.getElementById('githubBtn'),
            newCardBtn: document.getElementById('newCardBtn'),
            saveCardBtn: document.getElementById('saveCardBtn'),
            saveToGitHubBtn: document.getElementById('saveToGitHubBtn'),
            deleteCardBtn: document.getElementById('deleteCardBtn'),
            addStoryBtn: document.getElementById('addStoryBtn'),
            saveGitHubConfig: document.getElementById('saveGitHubConfig'),
            applyUISettings: document.getElementById('applyUISettings'),
            cardsList: document.getElementById('cardsList'),
            storiesList: document.getElementById('storiesList'),
            notification: document.getElementById('notification'),
            notificationText: document.getElementById('notificationText'),
            blurSlider: document.getElementById('blurSlider'),
            blurValue: document.getElementById('blurValue'),
            animationSlider: document.getElementById('animationSlider'),
            animationValue: document.getElementById('animationValue'),
            opacitySlider: document.getElementById('opacitySlider'),
            opacityValue: document.getElementById('opacityValue'),
            githubToken: document.getElementById('githubToken'),
            repoName: document.getElementById('repoName'),
            branchName: document.getElementById('branchName'),
            cardId: document.getElementById('cardId'),
            cardName: document.getElementById('cardName'),
            fileName: document.getElementById('fileName'),
            filePath: document.getElementById('filePath'),
            coverPath: document.getElementById('coverPath'),
            gender: document.getElementById('gender'),
            intro: document.getElementById('intro'),
            personality: document.getElementById('personality'),
            cardImageUpload: document.getElementById('cardImageUpload'),
            coverImageUpload: document.getElementById('coverImageUpload'),
            cardImageInput: document.getElementById('cardImageInput'),
            coverImageInput: document.getElementById('coverImageInput'),
            cardImagePreview: document.getElementById('cardImagePreview'),
            coverImagePreview: document.getElementById('coverImagePreview'),
            editorTitle: document.getElementById('editorTitle')
        };

        // 初始化应用
        function initApp() {
            applyTheme();
            applyUIValues();
            setupEventListeners();
            generateFileBrowser();
        }

        // 应用主题
        function applyTheme() {
            if (state.currentTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                elements.themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                if (elements.browserThemeToggle) {
                    elements.browserThemeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                }
            } else {
                document.documentElement.removeAttribute('data-theme');
                elements.themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                if (elements.browserThemeToggle) {
                    elements.browserThemeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
            }
        }

        // 应用UI设置
        function applyUIValues() {
            document.documentElement.style.setProperty('--blur', `${state.blurStrength}px`);
            document.documentElement.style.setProperty('--transition', `all ${0.4 - (state.animationSpeed/40)}s ease`);
            
            if (elements.blurSlider) {
                elements.blurSlider.value = state.blurStrength;
                elements.blurValue.textContent = state.blurStrength;
            }
            
            if (elements.animationSlider) {
                elements.animationSlider.value = state.animationSpeed;
                elements.animationValue.textContent = state.animationSpeed;
            }
            
            if (elements.opacitySlider) {
                elements.opacitySlider.value = state.opacityValue;
                elements.opacityValue.textContent = `${state.opacityValue}%`;
            }
            
            if (elements.githubToken) {
                elements.githubToken.value = state.githubToken;
            }
            
            if (elements.repoName) {
                elements.repoName.value = state.repoName;
            }
            
            if (elements.branchName) {
                elements.branchName.value = state.branchName;
            }
        }

        // 生成文件浏览器
        function generateFileBrowser() {
            if (!elements.fileBrowser) return;
            
            elements.fileBrowser.innerHTML = '';
            
            // 模拟仓库文件结构
            const folders = [
                { name: 'img', type: 'folder' },
                { name: 'covers', type: 'folder' },
                { name: 'characters', type: 'folder' },
                { name: 'data', type: 'folder' }
            ];
            
            const files = [
                { name: 'cards.json', type: 'file' },
                { name: 'config.json', type: 'file' },
                { name: 'README.md', type: 'file' }
            ];
            
            // 添加文件夹
            folders.forEach(folder => {
                const folderEl = document.createElement('div');
                folderEl.className = 'file-item folder';
                folderEl.innerHTML = `
                    <i class="fas fa-folder"></i>
                    <div class="file-name">${folder.name}</div>
                `;
                folderEl.addEventListener('click', () => {
                    state.currentPath += `${folder.name}/`;
                    elements.currentPath.textContent = state.currentPath;
                    generateFileBrowser();
                });
                elements.fileBrowser.appendChild(folderEl);
            });
            
            // 添加文件
            files.forEach(file => {
                const fileEl = document.createElement('div');
                fileEl.className = 'file-item file';
                fileEl.innerHTML = `
                    <i class="fas fa-file-code"></i>
                    <div class="file-name">${file.name}</div>
                `;
                fileEl.addEventListener('click', () => {
                    // 移除之前的选择
                    document.querySelectorAll('.file-item.file').forEach(el => {
                        el.classList.remove('selected');
                    });
                    // 选中当前文件
                    fileEl.classList.add('selected');
                    state.selectedFile = file.name;
                });
                elements.fileBrowser.appendChild(fileEl);
            });
        }

        // 打开选中的文件
        function openSelectedFile() {
            if (!state.selectedFile) {
                showNotification('请先选择一个文件！', 'error');
                return;
            }
            
            if (state.selectedFile !== 'cards.json') {
                showNotification('请选择cards.json文件！', 'error');
                return;
            }
            
            showNotification('正在加载角色卡数据...', 'info');
            
            // 模拟加载延迟
            setTimeout(() => {
                // 模拟从GitHub加载的卡片数据
                const demoCards = [
                    {
                        id: 'arc001',
                        name: '赛博忍者',
                        fileName: 'cyber-ninja-card.png',
                        filePath: 'img/cyber-ninja-card.png',
                        coverPath: 'img/cyber-ninja.png',
                        fileType: 'png',
                        uploadTime: new Date().toISOString(),
                        gender: 'male',
                        intro: '融合了传统忍术和尖端科技的战士，在黑夜的城市中执行神秘任务。',
                        personality: '冷静、神秘、高效，很少表露情感',
                        stories: [
                            '在城市的地下世界执行机密任务',
                            '使用古老的忍术对抗现代科技',
                            '守护着人类与技术之间的平衡'
                        ]
                    },
                    {
                        id: 'arc002',
                        name: '星界歌姬',
                        fileName: 'star-singer-card.png',
                        filePath: 'img/star-singer-card.png',
                        coverPath: 'img/star-singer.png',
                        fileType: 'png',
                        uploadTime: new Date().toISOString(),
                        gender: 'female',
                        intro: '拥有来自异次元的歌声，能用音乐影响现实世界的歌姬。',
                        personality: '活泼、有创造力、情感丰富',
                        stories: [
                            '举办星际巡回演唱会',
                            '用歌声化解文明间的冲突',
                            '探索神秘的音乐维度'
                        ]
                    }
                ];
                
                state.cards = demoCards;
                state.cardsLoaded = true;
                renderCardsList();
                
                if (state.cards.length > 0) {
                    selectCard(state.cards[0]);
                }
                
                // 切换到主应用视图
                elements.githubBrowser.classList.add('hidden');
                elements.mainApp.classList.remove('hidden');
                
                showNotification(`成功加载 ${state.cards.length} 张角色卡！`);
            }, 1500);
        }

        // 渲染卡片列表
        function renderCardsList() {
            if (!elements.cardsList) return;
            
            elements.cardsList.innerHTML = '';
            
            if (!state.cardsLoaded) {
                elements.cardsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-cloud-download-alt"></i>
                        <h3>未加载角色卡数据</h3>
                        <p>请先连接GitHub仓库并加载cards.json文件</p>
                    </div>
                `;
                return;
            }
            
            if (state.cards.length === 0) {
                elements.cardsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>没有角色卡数据</h3>
                        <p>cards.json文件中没有角色卡数据，请创建新角色卡</p>
                    </div>
                `;
                return;
            }
            
            state.cards.forEach(card => {
                const cardEl = document.createElement('div');
                cardEl.className = `card-item ${state.currentCard === card ? 'selected' : ''}`;
                cardEl.innerHTML = `
                    <div class="card-avatar">
                        <i class="fas ${card.gender === 'male' ? 'fa-mars' : 'fa-venus'}"></i>
                    </div>
                    <div class="card-info">
                        <h3>${card.name}</h3>
                        <p>${card.intro.substring(0, 60)}${card.intro.length > 60 ? '...' : ''}</p>
                    </div>
                    <div class="card-actions">
                        <button><i class="fas fa-pen"></i></button>
                    </div>
                `;
                cardEl.addEventListener('click', () => selectCard(card));
                elements.cardsList.appendChild(cardEl);
            });
        }

        // 选择卡片
        function selectCard(card) {
            state.currentCard = card;
            renderCardsList();
            
            // 更新编辑器标题
            if (elements.editorTitle) {
                elements.editorTitle.textContent = `编辑角色卡: ${card.name}`;
            }
            
            // 填充编辑表单
            if (elements.cardId) elements.cardId.value = card.id;
            if (elements.cardName) elements.cardName.value = card.name;
            if (elements.fileName) elements.fileName.value = card.fileName;
            if (elements.filePath) elements.filePath.value = card.filePath;
            if (elements.coverPath) elements.coverPath.value = card.coverPath;
            if (elements.gender) elements.gender.value = card.gender;
            if (elements.intro) elements.intro.value = card.intro;
            if (elements.personality) elements.personality.value = card.personality;
            
            // 显示图片预览
            if (card.filePath && elements.cardImagePreview) {
                elements.cardImagePreview.innerHTML = `<img src="${card.filePath}" alt="${card.name}">`;
            }
            
            if (card.coverPath && elements.coverImagePreview) {
                elements.coverImagePreview.innerHTML = `<img src="${card.coverPath}" alt="${card.name}封面">`;
            }
            
            // 填充故事
            if (elements.storiesList) {
                elements.storiesList.innerHTML = '';
                card.stories.forEach(story => {
                    const storyItem = document.createElement('div');
                    storyItem.className = 'story-item';
                    storyItem.innerHTML = `
                        <input type="text" value="${story}" class="story-input">
                        <i class="fas fa-times remove-story"></i>
                    `;
                    storyItem.querySelector('.remove-story').addEventListener('click', () => {
                        storyItem.remove();
                    });
                    elements.storiesList.appendChild(storyItem);
                });
            }
        }

        // 显示通知
        function showNotification(message, type = 'success') {
            if (!elements.notification || !elements.notificationText) return;
            
            elements.notification.className = `notification ${type}`;
            elements.notificationText.textContent = message;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        // 添加新故事
        function addNewStory() {
            if (!elements.storiesList) return;
            
            const storyItem = document.createElement('div');
            storyItem.className = 'story-item';
            storyItem.innerHTML = `
                <input type="text" placeholder="故事文本" class="story-input">
                <i class="fas fa-times remove-story"></i>
            `;
            storyItem.querySelector('.remove-story').addEventListener('click', () => {
                storyItem.remove();
            });
            elements.storiesList.appendChild(storyItem);
        }

        // 上传图片处理
        function handleImageUpload(inputElement, previewElement, type) {
            return new Promise((resolve) => {
                const file = inputElement.files[0];
                if (!file) return resolve(null);
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.src = e.target.result;
                    
                    img.onload = function() {
                        // 创建canvas进行压缩
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // 设置最大尺寸
                        const maxWidth = 800;
                        const maxHeight = 800;
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > height) {
                            if (width > maxWidth) {
                                height *= maxWidth / width;
                                width = maxWidth;
                            }
                        } else {
                            if (height > maxHeight) {
                                width *= maxHeight / height;
                                height = maxHeight;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // 转换为Data URL
                        const dataURL = canvas.toDataURL('image/jpeg', 0.8);
                        
                        // 显示预览
                        if (previewElement) {
                            previewElement.innerHTML = `<img src="${dataURL}" alt="预览">`;
                        }
                        
                        // 保存到状态
                        if (type === 'card') {
                            state.cardImage = {
                                file: file,
                                dataURL: dataURL,
                                name: file.name
                            };
                        } else {
                            state.coverImage = {
                                file: file,
                                dataURL: dataURL,
                                name: file.name
                            };
                        }
                        
                        resolve(dataURL);
                    };
                };
                reader.readAsDataURL(file);
            });
        }

        // 生成图片路径
        function generateImagePaths(cardName) {
            // 移除特殊字符并替换空格
            const safeName = cardName
                .replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '')
                .replace(/\s+/g, '-')
                .toLowerCase();
            
            const timestamp = new Date().getTime();
            
            return {
                fileName: `${safeName}-card.png`,
                filePath: `img/${safeName}-card.png`,
                coverPath: `img/${safeName}.png`
            };
        }

        // 保存卡片
        function saveCard() {
            if (!elements.cardId || !elements.cardName) {
                showNotification('ID和角色名是必填字段！', 'error');
                return;
            }
            
            if (!elements.cardId.value || !elements.cardName.value) {
                showNotification('ID和角色名是必填字段！', 'error');
                return;
            }
            
            let stories = [];
            if (elements.storiesList) {
                stories = Array.from(elements.storiesList.querySelectorAll('.story-input')).map(input => input.value);
            }
            
            // 生成图片路径
            const imagePaths = generateImagePaths(elements.cardName.value);
            
            if (state.currentCard) {
                // 更新现有卡片
                state.currentCard.id = elements.cardId.value;
                state.currentCard.name = elements.cardName.value;
                
                // 如果有新图片，更新路径
                if (state.cardImage) {
                    state.currentCard.fileName = imagePaths.fileName;
                    state.currentCard.filePath = imagePaths.filePath;
                }
                
                if (state.coverImage) {
                    state.currentCard.coverPath = imagePaths.coverPath;
                }
                
                state.currentCard.gender = elements.gender.value;
                state.currentCard.intro = elements.intro.value;
                state.currentCard.personality = elements.personality.value;
                state.currentCard.stories = stories;
                
                showNotification('角色卡更新成功！');
            } else {
                // 创建新卡片
                const newCard = {
                    id: elements.cardId.value,
                    name: elements.cardName.value,
                    fileName: imagePaths.fileName,
                    filePath: imagePaths.filePath,
                    coverPath: imagePaths.coverPath,
                    fileType: 'png',
                    uploadTime: new Date().toISOString(),
                    gender: elements.gender.value,
                    intro: elements.intro.value,
                    personality: elements.personality.value,
                    stories: stories
                };
                state.cards.push(newCard);
                state.currentCard = newCard;
                
                showNotification('新角色卡创建成功！');
            }
            
            // 更新表单中的路径显示
            if (elements.fileName) elements.fileName.value = state.currentCard.fileName;
            if (elements.filePath) elements.filePath.value = state.currentCard.filePath;
            if (elements.coverPath) elements.coverPath.value = state.currentCard.coverPath;
            
            renderCardsList();
        }

        // 删除卡片
        function deleteCard() {
            if (!state.currentCard) {
                showNotification('请先选择一个角色卡！', 'error');
                return;
            }
            
            if (confirm('确定要删除这个角色卡吗？此操作不可恢复。')) {
                const index = state.cards.indexOf(state.currentCard);
                if (index !== -1) {
                    state.cards.splice(index, 1);
                    if (state.cards.length > 0) {
                        selectCard(state.cards[0]);
                    } else {
                        state.currentCard = null;
                        clearForm();
                    }
                    renderCardsList();
                    showNotification('角色卡已删除！');
                }
            }
        }

        // 清空表单
        function clearForm() {
            if (elements.cardId) elements.cardId.value = '';
            if (elements.cardName) elements.cardName.value = '';
            if (elements.fileName) elements.fileName.value = '';
            if (elements.filePath) elements.filePath.value = '';
            if (elements.coverPath) elements.coverPath.value = '';
            if (elements.gender) elements.gender.value = 'male';
            if (elements.intro) elements.intro.value = '';
            if (elements.personality) elements.personality.value = '';
            
            // 重置图片预览
            if (elements.cardImagePreview) {
                elements.cardImagePreview.innerHTML = '<i class="fas fa-image" style="font-size: 3rem; color: #ccc;"></i>';
            }
            
            if (elements.coverImagePreview) {
                elements.coverImagePreview.innerHTML = '<i class="fas fa-image" style="font-size: 3rem; color: #ccc;"></i>';
            }
            
            // 重置图片状态
            state.cardImage = null;
            state.coverImage = null;
            
            // 重置故事列表
            if (elements.storiesList) {
                elements.storiesList.innerHTML = `
                    <div class="story-item">
                        <input type="text" placeholder="故事文本" class="story-input">
                        <i class="fas fa-times remove-story"></i>
                    </div>
                `;
            }
            
            // 更新编辑器标题
            if (elements.editorTitle) {
                elements.editorTitle.textContent = '创建新角色卡';
            }
        }

        // 新建卡片
        function createNewCard() {
            state.currentCard = null;
            clearForm();
            showNotification('准备创建新角色卡...', 'info');
        }

        // 保存GitHub配置
        function saveGitHubConfig() {
            if (!elements.githubToken || !elements.repoName) return;
            
            state.githubToken = elements.githubToken.value;
            state.repoName = elements.repoName.value;
            state.branchName = elements.branchName.value;
            
            localStorage.setItem('githubToken', state.githubToken);
            localStorage.setItem('repoName', state.repoName);
            localStorage.setItem('branchName', state.branchName);
            
            showNotification('GitHub配置已保存！');
        }

        // 应用UI设置
        function applyUISettings() {
            if (!elements.blurSlider || !elements.animationSlider || !elements.opacitySlider) return;
            
            state.blurStrength = parseInt(elements.blurSlider.value);
            state.animationSpeed = parseInt(elements.animationSlider.value);
            state.opacityValue = parseInt(elements.opacitySlider.value);
            
            localStorage.setItem('blur', state.blurStrength);
            localStorage.setItem('animationSpeed', state.animationSpeed);
            localStorage.setItem('opacity', state.opacityValue);
            
            document.documentElement.style.setProperty('--blur', `${state.blurStrength}px`);
            document.documentElement.style.setProperty('--transition', `all ${0.4 - (state.animationSpeed/40)}s ease`);
            
            showNotification('UI设置已应用！');
        }

        // 保存到GitHub
        function saveToGitHub() {
            if (!state.githubToken || !state.repoName) {
                showNotification('请先在设置中配置GitHub信息！', 'error');
                return;
            }
            
            // 模拟保存过程
            showNotification('正在保存到GitHub仓库...', 'info');
            
            setTimeout(() => {
                showNotification(`成功保存 ${state.cards.length} 张角色卡到 ${state.repoName} 仓库！`);
            }, 2000);
        }

        // 切换主题
        function toggleTheme() {
            state.currentTheme = state.currentTheme === 'light' ? 'dark' : 'light';
            localStorage.setItem('theme', state.currentTheme);
            applyTheme();
            showNotification(`已切换到${state.currentTheme === 'dark' ? '暗色' : '亮色'}主题`);
        }

        // 打开设置面板
        function openSettings() {
            if (elements.settingsPanel) {
                elements.settingsPanel.classList.add('active');
            }
        }

        // 关闭设置面板
        function closeSettings() {
            if (elements.settingsPanel) {
                elements.settingsPanel.classList.remove('active');
            }
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 主题切换
            if (elements.themeToggle) {
                elements.themeToggle.addEventListener('click', toggleTheme);
            }
            
            if (elements.browserThemeToggle) {
                elements.browserThemeToggle.addEventListener('click', toggleTheme);
            }
            
            // 设置面板
            if (elements.settingsBtn) {
                elements.settingsBtn.addEventListener('click', openSettings);
            }
            
            if (elements.browserSettingsBtn) {
                elements.browserSettingsBtn.addEventListener('click', openSettings);
            }
            
            if (elements.closeSettings) {
                elements.closeSettings.addEventListener('click', closeSettings);
            }
            
            // GitHub按钮
            if (elements.githubBtn) {
                elements.githubBtn.addEventListener('click', () => {
                    // 返回文件浏览器
                    if (elements.mainApp && elements.githubBrowser) {
                        elements.mainApp.classList.add('hidden');
                        elements.githubBrowser.classList.remove('hidden');
                    }
                });
            }
            
            // 打开文件按钮
            if (elements.openFileBtn) {
                elements.openFileBtn.addEventListener('click', openSelectedFile);
            }
            
            // 新建卡片
            if (elements.newCardBtn) {
                elements.newCardBtn.addEventListener('click', createNewCard);
            }
            
            // 保存卡片
            if (elements.saveCardBtn) {
                elements.saveCardBtn.addEventListener('click', saveCard);
            }
            
            // 保存到GitHub
            if (elements.saveToGitHubBtn) {
                elements.saveToGitHubBtn.addEventListener('click', saveToGitHub);
            }
            
            // 删除卡片
            if (elements.deleteCardBtn) {
                elements.deleteCardBtn.addEventListener('click', deleteCard);
            }
            
            // 添加故事
            if (elements.addStoryBtn) {
                elements.addStoryBtn.addEventListener('click', addNewStory);
            }
            
            // 保存GitHub配置
            if (elements.saveGitHubConfig) {
                elements.saveGitHubConfig.addEventListener('click', saveGitHubConfig);
            }
            
            // 应用UI设置
            if (elements.applyUISettings) {
                elements.applyUISettings.addEventListener('click', applyUISettings);
            }
            
            // 滑块事件
            if (elements.blurSlider) {
                elements.blurSlider.addEventListener('input', (e) => {
                    if (elements.blurValue) {
                        elements.blurValue.textContent = e.target.value;
                    }
                });
            }
            
            if (elements.animationSlider) {
                elements.animationSlider.addEventListener('input', (e) => {
                    if (elements.animationValue) {
                        elements.animationValue.textContent = e.target.value;
                    }
                });
            }
            
            if (elements.opacitySlider) {
                elements.opacitySlider.addEventListener('input', (e) => {
                    if (elements.opacityValue) {
                        elements.opacityValue.textContent = `${e.target.value}%`;
                    }
                });
            }
            
            // 图片上传处理
            if (elements.cardImageUpload && elements.cardImageInput) {
                elements.cardImageUpload.addEventListener('click', () => {
                    elements.cardImageInput.click();
                });
            }
            
            if (elements.coverImageUpload && elements.coverImageInput) {
                elements.coverImageUpload.addEventListener('click', () => {
                    elements.coverImageInput.click();
                });
            }
            
            if (elements.cardImageInput) {
                elements.cardImageInput.addEventListener('change', () => {
                    handleImageUpload(elements.cardImageInput, elements.cardImagePreview, 'card');
                });
            }
            
            if (elements.coverImageInput) {
                elements.coverImageInput.addEventListener('change', () => {
                    handleImageUpload(elements.coverImageInput, elements.coverImagePreview, 'cover');
                });
            }
        }

        // 初始化应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
